<!--
JSWM App list

This component is a list of open windows, it must be created inside a panel.

Author: Koas (alvaro.calleja@gmail.com)
https://github.com/koas/jswm

Events:

jswmWindowActive: emitted when a tab is clicked. The detail member of the
event contains the id of the window that gets active.

-->


<dom-module id="jswm-app-list">
	
	<template>
		<style>
		nav {
			display: flex;
			height: 100%;
			flex-wrap: wrap;
		}
		button {
			border: 0;
			height: 100%;
			background: rgba(81,81,81,1);
			border-radius: 6px;
			margin: 0 5px;
			background: linear-gradient(to bottom, rgba(81,81,81,1) 0%, rgba(51,51,51,1) 100%);
			border: 1px solid #464646;
			color: #fff;
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
    		user-select: none;
    		cursor: pointer;
    		outline: 0;
    		max-width: 120px;
    		white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		button::-moz-focus-inner {
			border: 0;
		}
		.active {
			background: rgba(137,137,137,1);
			background: linear-gradient(to bottom, rgba(137,137,137,1) 0%, rgba(63,63,63,1) 100%);
		}
		</style>
		<nav id="list">
		</nav>
	</template>

	<script>
	/*jshint esversion: 6 */
	/*jshint -W097 */
	/*jshint -W117 */
	"use strict";
	
	class JSWMappList extends Polymer.Element 
	{
		static get is() {return "jswm-app-list";}

		constructor()
		{
			super();

			// Listen to created window event
	        document.addEventListener("jswmWindowCreated", (e) => 
	        {
	        	jswmDebug("JSWMappList jswmWindowCreated event listener");
	        	let wnd = e.detail.wnd;

	        	// Create and add an app button  to the list
	        	let b = document.createElement("button");
				b.innerHTML = wnd.title;
				b.setAttribute("data-windowId", wnd.id);
				b.setAttribute("title", wnd.title);
				b.addEventListener("click", this.clicked.bind(this));
				b.addEventListener("auxclick", this.clicked.bind(this));
				this.$.list.appendChild(b);

				this.setActiveWindow(wnd.id);
	        });

	        // Listen to the active window event
	        document.addEventListener("jswmWindowActive", (e) => 
	        {
	        	this.setActiveWindow(e.detail.windowId);
	        });

	        // Listen to the minimized window event
	        document.addEventListener("jswmWindowMinimized", (e) => 
	        {
	        	// Remove the active class from the window button
	        	let buttons = this.getElementsByTagName("button");
				for (let x = 0; x < buttons.length; ++x)
				{
	    			if (buttons[x].getAttribute("data-windowId") == e.detail.windowId)
	    				buttons[x].classList.remove("active");
				}
	        });

	        // Listen to destroyed window event
	        document.addEventListener("jswmWindowDestroyed", (e) => 
	        {
	        	// Remove window button
	        	let buttons = this.getElementsByTagName("button");
				for (let x = 0; x < buttons.length; ++x)
				{
	    			if (buttons[x].getAttribute("data-windowId") == e.detail.windowId)
	    			{
	    				buttons[x].parentNode.removeChild(buttons[x]);
	    				break;
	    			}
		        }
		    });
		}

		setActiveWindow(windowId)
		{
			jswmDebug(`JSWMappList::setActiveWindow(${windowId})`);
			// Apply active class to selected button
			let buttons = this.$.list.getElementsByTagName("button");
			for (let x = 0; x < buttons.length; ++x)
			{
    			if (buttons[x].getAttribute("data-windowId") == windowId)
    			{
    				jswmDebug(`JSQMappList::setActiveWindow adding class active to window id: ${buttons[x].id} caption: ${buttons[x].title}`);
    				buttons[x].classList.add("active");
    			}
    			else
    			{
    				jswmDebug(`JSQMappList::setActiveWindow removing class active to window id: ${buttons[x].id} caption: ${buttons[x].title}`);
    				buttons[x].classList.remove("active");
    			}
			}
		}

		clicked(e)
		{
			let windowId = e.target.getAttribute("data-windowId");

			// If clicked with middle button, close window
			if (e.button === 1)
				document.getElementById(windowId).close();

			// If clicked with left button, activate window
			if (e.button === 0)
			{
				// Emit the window selected event
	        	let event = new CustomEvent("jswmWindowActive",
	        	{
	        		detail: {windowId: windowId}, bubbles: true, composed: true
	        	});
	        	this.dispatchEvent(event);
	        }
		}
	}

	customElements.define(JSWMappList.is, JSWMappList);
	</script>
</dom-module>
