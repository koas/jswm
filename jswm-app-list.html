<!--
JSWM App list

This component is a list of open windows, it must be created inside a panel.

Author: Koas (alvaro.calleja@gmail.com)
https://github.com/koas/jswm

CSS variables for styling:

--jswmAppListItemBorderRadius: buttons border radius. Default is 6px.

--jswmAppListItemBackgroundGradientStart: button background gradient start 
color. Default is #515151.

--jswmAppListItemBackgroundGradientEnd: button background gradient start color. 
Default is #333.

--jswmAppListActiveItemBackgroundGradientStart: active button background 
gradient start color. Default is #898989.

--jswmAppListActiveItemBackgroundGradientEnd: active button background gradient
start color. Default is #3f3f3f.

--jswmAppListItemMaxWidth: buttons max width. Default is 150px.

--jswmAppListItemFontFamily: buttons font family. Default is Arial.

--jswmAppListItemFontSize: buttons font size. Default is 13px.

--jswmAppListItemFontColor: buttons font color. Default is #fff;
-->


<dom-module id="jswm-app-list">
	
	<template>
		<style>
		nav {
			display: flex;
			height: 100%;
			flex-wrap: wrap;
		}
		button {
			border: 0;
			height: 100%;
			border-radius: var(--jswmAppListItemBorderRadius, 6px);
			margin: 0 5px;
			background: linear-gradient(to bottom, var(--jswmAppListItemBackgroundGradientStart, #515151) 0%, var(--jswmAppListItemBackgroundGradientEnd, #333) 100%);
			border: 1px solid #464646;
			color: var(--jswmAppListItemFontColor, #fff);
			font-family: var(--jswmAppListItemFontFamily, Arial);
			font-size: var(--jswmAppListItemFontSize, 13px);
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
    		user-select: none;
    		cursor: pointer;
    		outline: 0;
    		max-width: var(--jswmAppListItemMaxWidth, 150px);
    		white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		button::-moz-focus-inner {
			border: 0;
		}
		.active {
			background: linear-gradient(to bottom, var(--jswmAppListActiveItemBackgroundGradientStart, #898989) 0%, var(--jswmAppListActiveItemBackgroundGradientEnd, #3f3f3f) 100%);
		}
		</style>
		<nav id="list">
		</nav>
	</template>

	<script>
	/*jshint esversion: 6 */
	/*jshint -W097 */
	/*jshint -W117 */
	"use strict";
	
	class JSWMappList extends Polymer.Element 
	{
		static get is() {return "jswm-app-list";}

		constructor()
		{
			super();

			// Listen to created window event
	        document.addEventListener("jswmWindowCreated", (e) => 
	        {
	        	jswmDebug("JSWMappList jswmWindowCreated event listener");
	        	let wnd = e.detail.wnd;

	        	// Create and add an app button  to the list
	        	let b = document.createElement("button");
				b.innerHTML = wnd.title;
				b.setAttribute("data-windowId", wnd.id);
				b.setAttribute("title", wnd.title);
				b.addEventListener("click", this.clicked.bind(this));
				b.addEventListener("auxclick", this.clicked.bind(this));
				this.$.list.appendChild(b);

				this.setActiveWindow(wnd.id);
	        });

	        // Listen to the active window event
	        document.addEventListener("jswmWindowFocus", (e) => 
	        {
	        	this.setActiveWindow(e.detail.windowId);
	        });

	        // Listen to the minimized window event
	        document.addEventListener("jswmWindowMinimized", (e) => 
	        {
	        	// Remove the active class from the window button
	        	let buttons = this.getElementsByTagName("button");
				for (let x = 0; x < buttons.length; ++x)
				{
	    			if (buttons[x].getAttribute("data-windowId") == e.detail.windowId)
	    				buttons[x].classList.remove("active");
				}
	        });

	        // Listen to destroyed window event
	        document.addEventListener("jswmWindowDestroyed", (e) => 
	        {
	        	// Remove window button
	        	let buttons = this.getElementsByTagName("button");
				for (let x = 0; x < buttons.length; ++x)
				{
	    			if (buttons[x].getAttribute("data-windowId") == e.detail.windowId)
	    			{
	    				buttons[x].parentNode.removeChild(buttons[x]);
	    				break;
	    			}
		        }
		    });
		}

		setActiveWindow(windowId)
		{
			jswmDebug(`JSWMappList::setActiveWindow(${windowId})`);
			// Apply active class to selected button
			let buttons = this.$.list.getElementsByTagName("button");
			for (let x = 0; x < buttons.length; ++x)
			{
				let buttonWindowId = buttons[x].getAttribute("data-windowId");
    			if (buttonWindowId == windowId)
    			{
    				jswmDebug(`JSQMappList::setActiveWindow adding class active to window id: ${buttonWindowId} caption: ${buttons[x].title}`);
    				buttons[x].classList.add("active");
    			}
    			else
    			{
    				jswmDebug(`JSQMappList::setActiveWindow removing class active to window id: ${buttons[x].id} caption: ${buttons[x].title}`);
    				buttons[x].classList.remove("active");

    				// Emit the jswmWindowBlur event
    				let event = new CustomEvent("jswmWindowBlur",
		        	{
		        		detail: {windowId: buttonWindowId}, bubbles: true, composed: true
		        	});
		        	this.dispatchEvent(event);
    			}
			}
		}

		clicked(e)
		{
			let windowId = e.target.getAttribute("data-windowId");

			// If clicked with middle button, close window
			if (e.button === 1)
				document.getElementById(windowId).close();

			// If clicked with left button, activate window
			if (e.button === 0)
			{
				// Emit the window focus event
	        	let event = new CustomEvent("jswmWindowFocus",
	        	{
	        		detail: {windowId: windowId}, bubbles: true, composed: true
	        	});
	        	this.dispatchEvent(event);
	        }
		}
	}

	customElements.define(JSWMappList.is, JSWMappList);
	</script>
</dom-module>
