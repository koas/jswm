<!--
JSWM Window

This component is a window (an iframe with a caption and borders).

Author: Koas (alvaro.calleja@gmail.com)
https://github.com/koas/jswm

Properties:

url: URL for the iframe
title: caption for the window

-->

<dom-module id="jswm-window">

	<template>
		<style>
		.main {
			width: 300px;
			height: 300px;
			position: absolute;
			left: 580px;
			top: 70px;
			display: grid;
			grid-template-columns: 6px auto 6px;
			grid-template-rows: 6px auto 6px;
			grid-template-areas: 
			"nw n ne"
			"w content e"
			"sw s se";
			box-shadow: 0 25px 25px 0 rgba(0, 0, 0, 0.5), 0 0 25px 5px rgba(0, 0, 0, 0.25);
			border-radius: 6px;
		}
		.nw {
			grid-area: nw;
			cursor: nw-resize;
			background-color: #fff;
			border-top-left-radius: 100%;
		}
		.ne {
			grid-area: ne;
			cursor: ne-resize;
			background-color: #fff;
			border-top-right-radius: 100%;
		}
		.n {
			grid-area: n;
			cursor: n-resize;
			background-color: #fff;
		}
		.sw {
			grid-area: sw;
			cursor: sw-resize;
			background-color: #fff;
			border-bottom-left-radius: 100%;
		}
		.se {
			grid-area: se;
			cursor: se-resize;
			background-color: #fff;
			border-bottom-right-radius: 100%;
		}
		.s {
			grid-area: s;
			cursor: s-resize;
			background-color: #fff;
		}
		.w {
			grid-area: w;
			cursor: w-resize;
			background-color: #fff;
		}
		.e {
			grid-area: e;
			cursor: e-resize;
			background-color: #fff;
		}
		.content {
			grid-area: content;
			display: flex;
			background: #fff;
			flex-direction: column;
		}
		.title {
			cursor: move;
			display: flex;
			border-bottom: 1px solid #eee;
			padding: 5px;
			align-items: center;
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
    		user-select: none;
		}
		.ifrCont {
			flex-grow: 1;
			position: relative;
		}
		.ifr {
			width: 100%;
			height: 100%;
			background: black;
			border: 0;
		}
		.ifrCover {
			position: absolute;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: transparent;
			display: none;
		}
		.caption {
			flex-grow: 1;
			font-family: 'Raleway', sans-serif;
			font-weight: 100;
			font-size: 20px;
		}
		.close {
			width: 16px;
			height: 16px;
			cursor: pointer;
			background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAoUlEQVQ4jZ3SSwqDMBAGYO+ReLWAMJCJOoW4CJg5kiBdlLYre7UuSrHB1Dxmlc3/MY80mvgK4GRTWF0/tTjw+nmM/lmCdP3UGuK7Qit2LRM5hIOWEsjf8LcAnNTEjxiSDJ8h2eEYUhwOkJFfhvxWHN7b9pu5VAC/bQM4WTRCbOZs5GxhSSRn2wqtMMS36C/MnfOA1Nw5QHDgtebOCq3QNC9vVkWLrEbgQiEAAAAASUVORK5CYII=);
		}
		</style>
		<div id="main" class="main">
			<div class="nw" data-mouseOp="resizeNW" on-mousedown="setMouseOp"></div>
			<div class="ne" data-mouseOp="resizeNE" on-mousedown="setMouseOp"></div>
			<div class="n" data-mouseOp="resizeN" on-mousedown="setMouseOp"></div>
			<div class="sw" data-mouseOp="resizeSW" on-mousedown="setMouseOp"></div>
			<div class="se" data-mouseOp="resizeSE" on-mousedown="setMouseOp"></div>
			<div class="s" data-mouseOp="resizeS" on-mousedown="setMouseOp"></div>
			<div class="w" data-mouseOp="resizeW" on-mousedown="setMouseOp"></div>
			<div class="e" data-mouseOp="resizeE" on-mousedown="setMouseOp"></div>
			<div class="content">
				<div class="title">
					<div class="caption" data-mouseOp="move" 
						 on-mousedown="setMouseOp">{{title}}</div>
					<div class="close" on-click="close"></div>
				</div>
				<div class="ifrCont">
					<iframe class="ifr" src="{{url}}"></iframe>
					<div id="ifrCover" class="ifrCover"></div>
				</div>
			</div>
		</div>
	</template>

	<script>
	/*jshint esversion: 6 */
	/* jshint -W097 */
	"use strict";
	
	class JSWMwindow extends Polymer.Element 
	{
		static get is() {return "jswm-window";}

		static get properties()
		{
			return {
				url: {type: String, value: "about:blank", reflectToAttribute: true},
				title: {type: String, value: "Window", reflectToAttribute: true},
				id: {type: String, value: "jswmWindow", reflectToAttribute: true}
			};
		}

		constructor() 
    	{
        	super();

        	this.startX = 0;
        	this.startY = 0;
        	this.mouseOp = "";
        }

        connectedCallback()
        {
        	super.connectedCallback();

        	// Register the window in the parent desktop element (only if we are
	        // inside one)
	        if (this.parentElement.tagName == "JSWM-DESKTOP")
	        	this.parentElement.registerWindow(this);
        }
		
        close()
        {
        	// Notify the parent desktop element (if any)
        	if (this.parentElement.tagName == "JSWM-DESKTOP")
        		this.parentElement.removeWindow(this);

        	// Destroy the window
        	this.parentElement.removeChild(this);
        }

		setMouseOp(e)
		{
			this.mouseOp = e.target.getAttribute("data-mouseOp");
		}

		mouseDown(x, y)
		{
			this.startX = x;
    		this.startY = y;
    		this.$.ifrCover.style.display = "block";
   		}

   		mouseUp()
   		{
   			this.$.ifrCover.style.display = "none";
   		}

		mouseMove(x, y)
		{
			let incX = this.startX - x;
		    let incY = this.startY - y;
		    this.startX = x;
		    this.startY = y;

		    // Are we moving or resizing?
		    switch (this.mouseOp)
		    {
		    	// Moving
		    	case "move":
		    		this.$.main.style.left = (this.$.main.offsetLeft - incX) + "px";
		    		this.$.main.style.top = (this.$.main.offsetTop - incY) + "px";
		    	break;

		    	// Resizing east
		    	case "resizeE":
		    		this.$.main.style.width = (this.$.main.offsetWidth - incX) + "px";
		    	break;

		    	// Resizing west
		    	case "resizeW":
		    		this.$.main.style.left = (this.$.main.offsetLeft - incX) + "px";
		    		this.$.main.style.width = (this.$.main.offsetWidth + incX) + "px";
		    	break;

		    	// Resizing south
		    	case "resizeS":
		    		this.$.main.style.height = (this.$.main.offsetHeight - incY) + "px";
		    	break;

		    	// Resizing north
		    	case "resizeN":
		    		this.$.main.style.height = (this.$.main.offsetHeight + incY) + "px";
		    		this.$.main.style.top = (this.$.main.offsetTop - incY) + "px";
		    	break;	

		    	// Resizing south east
		    	case "resizeSE":
		    		this.$.main.style.width = (this.$.main.offsetWidth - incX) + "px";
		    		this.$.main.style.height = (this.$.main.offsetHeight - incY) + "px";
		    	break;

		    	// Resizing south west
		    	case "resizeSW":
		    		this.$.main.style.left = (this.$.main.offsetLeft - incX) + "px";
		    		this.$.main.style.width = (this.$.main.offsetWidth + incX) + "px";
		    		this.$.main.style.height = (this.$.main.offsetHeight - incY) + "px";
		    	break;

		    	// Resizing north west
		    	case "resizeNW":
		    		this.$.main.style.left = (this.$.main.offsetLeft - incX) + "px";
		    		this.$.main.style.height = (this.$.main.offsetHeight + incY) + "px";
		    		this.$.main.style.width = (this.$.main.offsetWidth + incX) + "px";
		    		this.$.main.style.top = (this.$.main.offsetTop - incY) + "px";
		    	break;

		    	// Resizing north east
		    	case "resizeNE":
		    		this.$.main.style.height = (this.$.main.offsetHeight + incY) + "px";
		    		this.$.main.style.width = (this.$.main.offsetWidth - incX) + "px";
		    		this.$.main.style.top = (this.$.main.offsetTop - incY) + "px";
		    	break;
		    }
		}
	}

	customElements.define(JSWMwindow.is, JSWMwindow);
	</script>
</dom-module>
